---
// Diary Editor component
const today = new Date().toLocaleDateString("es-ES", {
  weekday: "long",
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<div class="bg-card rounded-lg border border-border flex flex-col h-[45vh] lg:h-[55vh]">
  <div class="p-4 border-b border-border flex items-center justify-between">
    <div class="flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>
      <div>
        <h2 class="font-semibold text-foreground">Entrada de Hoy</h2>
        <p class="text-xs text-muted-foreground capitalize">{today}</p>
      </div>
    </div>
    <button id="save-btn" class="px-3 py-2 bg-primary text-primary-foreground rounded-md text-sm flex items-center gap-2 hover:bg-primary/90 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
      Guardar
    </button>
  </div>

  <div class="flex-1 p-4 overflow-y-auto">
    <textarea
      id="diary-content"
      placeholder="¿Cómo te sientes hoy? Escribe sobre tu día, emociones, pensamientos..."
      class="w-full h-full bg-transparent resize-none focus:outline-none text-foreground placeholder:text-muted-foreground text-base leading-relaxed"
    ></textarea>
  </div>

  <div class="p-3 border-t border-border flex items-center justify-between text-xs text-muted-foreground">
    <span id="char-count">0 caracteres</span>
    <span id="read-time">0 min de lectura</span>
  </div>
</div>

<script>
  const textarea = document.getElementById('diary-content') as HTMLTextAreaElement;
  const charCount = document.getElementById('char-count');
  const readTime = document.getElementById('read-time');
  const saveBtn = document.getElementById('save-btn');

  textarea?.addEventListener('input', () => {
    const content = textarea.value;
    const chars = content.length;
    const words = content.split(' ').filter(Boolean).length;
    const minutes = Math.ceil(words / 200);

    if (charCount) charCount.textContent = `${chars} caracteres`;
    if (readTime) readTime.textContent = `${minutes} min de lectura`;
  });

  saveBtn?.addEventListener('click', () => {
    const content = textarea?.value;
    console.log('Guardando entrada:', content);
    // Aquí puedes agregar lógica para guardar en localStorage o una API
    alert('¡Entrada guardada!');
  });
</script>

<style>
  button {
    cursor: pointer;
    border: none;
  }
</style>